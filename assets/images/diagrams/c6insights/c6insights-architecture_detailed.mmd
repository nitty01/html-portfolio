---
config:
  layout: elk
---
flowchart TD
 subgraph DS["üì• Data Sources"]
        A[Vehicle Telemetry<br>Streaming Data]
        B[Fuel Price APIs]
        C[AQI APIs]
        D[Other Sources<br>Monthly Manual<br>Electricity Prices, Grid Emissions, Replacement Vehicles]
        E[EV Incentives<br>Data]
  end
  
 subgraph ING["‚ö° Ingestion Layer"]
        F[Apache Kafka<br>Message Queue]
        G[AWS Lambda<br>Fuel Price Scraper<br>Event Triggered]
        H[API Consumer<br>AQI Data]
  end
  
 subgraph PROC["‚öôÔ∏è Processing Layer"]
        I[PySpark Processing<br>AWS EMR]
        J[Deep View Analytics Platform<br>Master-Slave Architecture<br>Horizontally Scalable]
        K[Batch Processing<br>Job-based]
        L[Metadata Enhancement<br>Pod-based Processing]
  end
  
 subgraph MSG["üì® Messaging Layer"]
        M[RabbitMQ<br>Job Parallelization<br>Delay Queue & DLQ]
  end
  
 subgraph STOR["üíæ Storage Layer"]
        N[(S3 Data Lake<br>Raw Vehicle Data)]
        O[(MongoDB<br>Raw Data Store<br>Vehicle, Fuel, AQI, Other)]
        P[(PostgreSQL<br>Job Metadata)]
        Q[(Chroma DB<br>Vector Store<br>EV Incentives RAG)]
  end
  
 subgraph GENAI["ü§ñ GenAI Processing"]
        R[Ollama LLM<br>Local Inference]
        S[RAG Pipeline<br>Chroma DB Vector Search]
        T[MCP Integration<br>Vehicle Data Access]
        U[Vehicle Replacement<br>Identification Engine<br>Cost, Fuel, Carbon, Travel/Service Area]
        V[Fleet Roadmap<br>Generation Engine<br>Year-on-Year with ROI & Carbon Savings]
  end
  
 subgraph API["üåê API Layer"]
        W[FastAPI Gateway<br>Data Serving]
        X[FastAPI<br>Metadata Enhancement Endpoint]
        Y[FastAPI<br>Simulation Endpoint]
  end
  
 subgraph FE["üé® Frontend Layer"]
        Z[Fleet Management Dashboard]
        AA[Carbon Emission Reports]
        AB[Vehicle Replacement UI<br>Simulation Trigger]
        AC[ROI Calculator]
  end
  
 subgraph INF["‚öôÔ∏è Infrastructure"]
        AD[Kubernetes<br>Pod Orchestration]
        AE[Docker Containers]
        AF[AWS Cloud Services]
        AG[Monitoring & Logging]
  end
  
    A --> F
    F --> I
    I --> N
    I --> O
    
    B --> G
    G --> O
    
    C --> H
    H --> O
    
    D --> O
    
    E --> Q
    
    O --> J
    Q --> J
    J --> P
    J --> M
    J --> O
    J --> M
    
    X --> M
    M --> L
    L --> O
    
    AB --> Y
    Y --> R
    R --> S
    R --> T
    S --> Q
    T --> O
    R --> U
    U --> V
    V --> Y
    Y --> M
    M --> W
    
    O --> W
    P --> W
    W --> Z
    W --> AA
    W --> AC
    
    J --> AD
    L --> AD
    AD --> AE
    AD --> AF
    AF --> AG
    
     DS:::sources
     ING:::ingestion
     PROC:::processing
     MSG:::messaging
     STOR:::storage
     GENAI:::genai
     API:::api
     FE:::frontend
     INF:::infra
     
class A,B,C,D,E sources;
class F,G,H ingestion;
class I,J,K,L processing;
class M messaging;
class N,O,P,Q storage;
class R,S,T,U,V genai;
class W,X,Y api;
class Z,AA,AB,AC frontend;
class AD,AE,AF,AG infra;

    classDef sources fill:#E8F1F2,stroke:#134074,stroke-width:2px,color:#0B2545
    classDef ingestion fill:#E3F2FD,stroke:#1565C0,stroke-width:2px,color:#0D47A1
    classDef processing fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,color:#1B5E20
    classDef messaging fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px,color:#4A148C
    classDef storage fill:#FFF3E0,stroke:#EF6C00,stroke-width:2px,color:#E65100
    classDef genai fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px,color:#4A148C
    classDef api fill:#C8E6C9,stroke:#4CAF50,stroke-width:2px,color:#1B5E20
    classDef frontend fill:#FFF8E1,stroke:#F57F17,stroke-width:2px,color:#4E342E
    classDef infra fill:#ECEFF1,stroke:#37474F,stroke-width:2px,color:#263238
